!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).embroidery={})}(this,function(t){function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var n,r,i={a:"click",button:"click",form:"submit",input:"input",select:"change",textarea:"input"},a=function(){function t(t,e){this.context=e,this.cache={"data-target":{},"data-action":{},"data-targets":{},"data-actions":{}},this.dataAttr=t.getAttribute("data-controller"),this.targetElements=t.querySelectorAll("[data-target]"),this.actionElements=t.querySelectorAll("[data-action]"),this.targetsElements=t.querySelectorAll("[data-targets]"),this.actionsElements=t.querySelectorAll("[data-actions]"),this.updateCache(this.targetElements,"data-target"),this.updateCache(this.actionElements,"data-action"),this.updateCache(this.targetsElements,"data-targets"),this.updateCache(this.actionsElements,"data-actions"),this.create(),"function"==typeof this.context[this.dataAttr].init&&this.context[this.dataAttr].init(this.cache["data-target"])}var n=t.prototype;return n.getKey=function(t,e,n){return t.length>0?e.getAttribute(n).slice(0,-2)+"Targets":e.getAttribute(n)},n.updateCache=function(t,n){var r=this,i=[];null==t||t.forEach(function(t){var a,o,c=t.getAttribute("data-target");(null==c?void 0:c.endsWith("[]"))&&(i=[].concat(i,[t])),r.cache=e({},r.cache,((o={})[n]=e({},r.cache[n],((a={})[r.getKey(i,t,n)]=i.length>0?i:t,a)),o))})},n.create=function(){var t=this;this.actionElements.forEach(function(e){var n=e.getAttribute("data-action");if(!n)throw new Error("[Embroidery]: An action attribute was specified without an action. Is the action an empty string or missing?");n.trim().split(/\s+/).map(function(n){var r=null,a=null;if(n.includes("->")){var o=n.split("->");r=o[0],a=o[1]}else{var c=e.tagName.toLowerCase();r=i[c],a=n}if(!r)throw new Error("[Embroidery]: Missing event on "+e+", for example click or change.");if(!a)throw new Error("[Embroidery]: Missing function on "+e+". Specify your function in the controller.");e.addEventListener(r,function(){t.context[t.dataAttr][a](t.cache["data-target"])})})})},t}(),o=function(){function t(t){this.element=t,this.dataAttr=t.getAttribute("data-partial"),this.create()}return t.prototype.create=function(){try{var t=this;return Promise.resolve(fetch(t.dataAttr,{headers:{"Content-Type":"text/html"}})).then(function(e){return Promise.resolve(e.text()).then(function(e){t.element.insertAdjacentHTML("beforeend",e)})})}catch(t){return Promise.reject(t)}},t}();!function(t){t.Controller="[data-controller]",t.Partial="[data-partial]"}(n||(n={})),function(t){t.Controller="controller",t.Partial="partial"}(r||(r={})),t.Embroidery=function(){function t(){var t;this.cache=((t={})[r.Controller]=[],t[r.Partial]=[],t)}t.start=function(){var e=new t;return e.start(),e};var i=t.prototype;return i.start=function(){try{var t=this;return Promise.resolve(new Promise(function(t){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",t):t()})).then(function(){console.info("Embroidery started."),t.discover(function(e){t.initialize(e)},n.Controller),t.discover(function(e){t.initialize(e)},n.Partial),t.listenForNewUninitializedControllersAtRuntime(function(e){t.initialize(e)})})}catch(t){return Promise.reject(t)}},i.register=function(t){this.context=e({},this.context,t)},i.discover=function(t,e){document.querySelectorAll(e).forEach(function(e){return t(e)})},i.updateCache=function(t,n){var r;this.cache=e({},this.cache,((r={})[n]=[].concat(this.cache[n],[t]),r))},i.initialize=function(t){var e=this;t.dataset?Object.keys(t.dataset).forEach(function(n){switch(n){case r.Controller:return e.updateCache(t,r.Controller),new a(t,e.context);case r.Partial:return e.updateCache(t,r.Partial),new o(t);default:throw new Error("Element is not a specified data type, like controller or partial. Did you forget to register it?")}}):console.error("An element "+t+" was picked up but could not be initialized")},i.discoverUninitializedControllers=function(t,e){var r=this;return void 0===e&&(e=null),Array.from((e||document).querySelectorAll(n.Controller)).filter(function(t){var e;return!(null==(e=r.cache[n.Controller])?void 0:e.includes(t))}).map(function(e){return t(e)})},i.listenForNewUninitializedControllersAtRuntime=function(t){var e=this;new MutationObserver(function(r){return r.map(function(r){var i=r.addedNodes;i.length>0&&i.forEach(function(r){var i;1===r.nodeType&&((null==(i=r.parentElement)?void 0:i.closest(n.Controller))||e.discoverUninitializedControllers(function(e){t(e)},r.parentElement))})})}).observe(document.querySelector("body"),{childList:!0,attributes:!0,subtree:!0})},t}()});
//# sourceMappingURL=embroidery.umd.js.map
